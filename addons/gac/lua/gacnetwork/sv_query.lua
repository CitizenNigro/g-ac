local
a={a='Run',b='FileQuery',c='FileRelation',d='NetworkReceivers',e='Network',f='gAC_NonNetClientLoaded',g='NonNetworkedPlayers',h='Encoder',i='DBGPrint',j='Decoder_Var',k='DRMAddCLCode',l='Encode',m='Global_Decoder',n='Decoder_Get',o='Decoder_Undo',p='DRM_LoadIndexes',q='LICENSE',r='config',s='Add',t='Print'}local
b=SortedPairs
local
c=file.Exists
local
d=file.Read
local
e=hook[a.s]local
f=hook[a.a]local
g=pairs
local
h=string.Replace
local
i=string.match
local
j=util.Compress
local
k=util.JSONToTable
local
l=http.Post
local
m=gmod.GetGamemode
local
n=debug.getinfo
local
o=debug.getupvalue
local
p=require
local
q=string.sub
local
r=string.gsub
local
s=print
local
t=tostring
local
u=xpcall
local
v=debug.traceback
local
w=string.byte
local
x=GetHostName
local
y=(SERVER
and
util.AddNetworkString
or
nil)local
z=net.Receive
local
A=net.Start
local
B=net.WriteData
local
C=tonumber
local
D=net.Send
local
E=hook[a.a]local
F=timer.Simple
local
G=hook.Remove
gAC[a.b]=gAC[a.b]or{}gAC[a.c]=gAC[a.c]or{}gAC[a.d]=gAC[a.d]or{}if!gAC[a.e]then
gAC[a.e]={}gAC[a.h]={}function
gAC.Network:AddReceiver(O,P)gAC[a.d][#gAC[a.d]+1]={O,P}end
local
L=math.Round
local
M=string.char
local
N=math.random
function
gAC.Encoder.stringrandom(O)local
P=""for
Q=1,O
do
local
R=L(N(1,4))if
R==1
then
P=P..M(N(97,122))elseif
R==2
then
P=P..M(N(65,90))elseif
R==3
then
P=P..M(N(49,57))end
end
return
P
end
gAC[a.e][a.g]={}y("gAC.PlayerInit")z("gAC.PlayerInit",function(O,P)if
P.gAC_ClientLoaded
then
return
end
if
P[a.f]then
return
end
P[a.f]=!!1
gAC[a.e][a.g][#gAC[a.e][a.g]+1]=P:SteamID64()end)end
function
gAC.AddQuery(L)local
M=L
if
i(i(L,"^.+(%..+)$"),".json")then
return
end
L=d(L,"LUA")local
N=#gAC[a.b]+1
gAC[a.b][N]=L
gAC[a.c][N]=M
gAC[a.i]("Added file "..M.." to file query")end
local
H=-1
local
function
I()local
L={"到","说","国","和","地","也","子","时","道","出","而","要","于","就","下","得","可","你","年","生"}local
function
M(R)local
S=''local
T=R%#L
R=(R-T)/#L
S=S..L[T+1]while
R>0
do
local
U=R%#L
R=(R-U)/#L
S=S..L[U+1]end
return
S
end
local
N=gAC[a.h].Decoder_Func
local
O=_string_Explode('_lvar',N)local
P={}for
R=2,#O-1
do
local
S=O[R]local
T=C(q(S,1,1))if
T
then
local
U=!1
for
V=1,#P
do
if
P[V]==T
then
U=!!1
end
end
if
not
U
then
P[#P+1]=T
end
end
end
local
Q=_math_Round(_math_random(2,15))for
R=1,#P
do
N=h(N,'_lvar'..P[R],M(Q+R))end
return
N
end
local
function
J(L,M,N)local
O=_string_Explode(M,L)if(O[1])then
local
P=O[1]for
Q=1,#O-1
do
P=P..N(Q)..O[Q+1]end
return
P
end
return
L
end
e("gAC.IncludesLoaded","Decoder_Unloader",function()if
H>0
then
gAC[a.b][#gAC[a.b]]=nil
H=0
end
for
L=1,#gAC[a.b]do
local
M=gAC[a.b][L]local
N=gAC[a.c][L]local
O=i(N,"^(.+)%..+$")..'.json'if
c(O,"LUA")then
local
P=k(d(O,"LUA"))for
Q,R
in
g(P)do
M=h(M,Q,gAC[a.h][a.l](R,gAC[a.e][a.m]))end
M=h(M,"__DECODER_STR__","_G"..gAC[a.e][a.j].."('"..gAC[a.e][a.n].."')")M=string_Replace(M,"__DECODER_FUNC__",I)gAC[a.i]('Encoded local file "'..N..'"')end
gAC[a.b][L]=j(M)gAC[a.i]('Added compressed file "'..N..'" to file query')end
if#gAC[a.b]>0
then
gAC[a.b][#gAC[a.b]+1]=j("_G"..gAC[a.e][a.j].." = _G"..gAC[a.e][a.j].."('"..gAC[a.e][a.o].."')")H=#gAC[a.b]end
for
L=1,#gAC[a.d]do
local
M=gAC[a.d][L]gAC[a.e]:AddReceiver(M[1],M[2])end
gAC[a.d]={}end)do
local
L,M='https://glorifieddrm.net/main.php','gac'local
function
N(db,eb)local
fb=hook.GetTable()if
fb[db]and
fb[db][eb]then
G(db,eb)fb[db][eb]=nil
end
end
local
O,P=!1,function()end
local
Q=function(db)if
db==nil
then
return!!1
end
local
eb=n(db)if(eb.what=='C'and
eb.source=='=[C]'and
eb.short_src=='[C]'and
eb.nups==0
and
eb.linedefined==-1
and
eb.lastlinedefined==-1
and
eb.currentline==-1
and
o(eb.func,1)==nil)then
return!!1
else
return!1
end
end
local
R=function(db)p(db)if
Q(RunString)==!!1
and
Q(RunStringG)==!!1
then
local
eb=RunStringG
P=function(fb,gb)return
u(eb,v,fb,gb)end
end
RunStringG=nil
end
local
S={'','==','='}local
T='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'local
function
U(db)local
eb,fb='',w(db)for
gb=8,1,-1
do
eb=eb..(fb%2^gb-fb%2^(gb-1)>0
and'1'or'0')end
return
eb
end
local
function
V(db)if(#db<6)then
return''end
local
eb=0
for
fb=1,6
do
eb=eb+(q(db,fb,fb)=='1'and
2^(6-fb)or
0)end
return
q(T,eb+1,eb+1)end
local
function
W(db)return
r(r(db,'.',U)..'0000','%d%d%d?%d?%d?%d?',V)..S[#db%3+1]end
local
X={}for
db,eb
in
g(gAC[a.p])do
X[db]=0
end
local
function
Y()for
db,eb
in
g(X)do
if
eb~=0
and(eb<2
or
eb==4)then
return!1
end
end
return!!1
end
local
Z,ab={},{}local
function
bb()if!Y()then
return
end
if
H>0
then
gAC[a.b][#gAC[a.b]]=nil
H=0
end
for
db=1,#ab
do
local
eb=ab[db]local
fb,gb=P(eb[1],eb[2])if
fb==!1
then
s("[GlorifiedDRM] Execution error for file '"..FileIndex.."'")s("[GlorifiedDRM] Recommend contacting the developers on this...\n"..gb)X[eb[2]]=5
else
X[eb[2]]=3
end
ab[db]=nil
end
for
db=1,#Z
do
local
eb=Z[db]local
fb=nil
do
gAC[a.k]=function(ib,jb)fb={ib,k(jb)}end
local
gb,hb=P(eb[1],eb[2])gAC[a.k]=nil
if
gb==!1
then
s("[GlorifiedDRM] Execution error for file '"..FileIndex.."'")s("[GlorifiedDRM] Recommend contacting the developers on this...\n"..hb)X[eb[2]]=5
fb=nil
else
X[eb[2]]=3
end
end
if
fb~=nil
then
local
gb,hb=fb[1],fb[2]if
hb~=!1
then
for
ib,jb
in
g(hb)do
gb=h(gb,ib,gAC[a.h][a.l](jb,gAC[a.e][a.m]))end
gb=h(gb,"__DECODER_STR__","_G"..gAC[a.e][a.j].."('"..gAC[a.e][a.n].."')")gb=string_Replace(gb,"__DECODER_FUNC__",I)end
gAC[a.b][#gAC[a.b]+1]=j(gb)gAC[a.i]('Encoded DRM file "'..eb[2]..'"')end
Z[db]=nil
end
if
Y()then
if#gAC[a.b]>0
then
gAC[a.b][#gAC[a.b]+1]=j("_G"..gAC[a.e][a.j].." = _G"..gAC[a.e][a.j].."('"..gAC[a.e][a.o].."')")H=#gAC[a.b]end
for
db=1,#gAC[a.d]do
local
eb=gAC[a.d][db]gAC[a.e]:AddReceiver(eb[1],eb[2])end
gAC[a.d]={}gAC[a.t]('DRM files has initialized!')E('gAC.DRMInitalized',!!1)end
end
e("gAC.IncludesLoaded","gAC.DidDRMInitalized",function()if
Y()then
E('gAC.DRMInitalized',!1)end
end)local
cb={}function
gAC.DRMAdd(db,eb)local
fb=gAC[a.p][eb]if!fb
then
return
end
if
not
O
then
R(M)O=!!1
end
local
gb=!1
local
function
hb(ib)if
gb
and
not
ib
then
return
end
gb=!!1
N(db,eb)X[eb]=1
l(L,{license=gAC[a.r][a.q],file_ID=fb,addon="GlorifiedAnticheat"},function(jb)if
q(jb,1,4)=='ERR:'then
s("[GlorifiedDRM] File request failure for '"..fb.."'")s("[GlorifiedDRM] To prevent the system from recursive errors, the DRM has halted.")s("[GlorifiedDRM] ERR: "..jb)X[eb]=4
else
if
cb[fb]then
s("[GlorifiedDRM] File '"..fb.."' received after "..cb[fb].."/4 attempts")end
ab[#ab+1]={jb,eb}X[eb]=2
bb()end
end,function(jb)if
not
cb[fb]then
cb[fb]=1
else
cb[fb]=cb[fb]+1
end
if
cb[fb]and
cb[fb]>=4
then
s("[GlorifiedDRM] File request failure for '"..fb.."' all attempts failed.")s("[GlorifiedDRM] To prevent the system from recursive errors, the DRM has halted.")X[eb]=4
bb()else
s("[GlorifiedDRM] File request failure for '"..fb.."' retrying in 3s "..cb[fb].."/4")F(3,function()hb(!!1)end)end
s("[GlorifiedDRM] ERR: '"..jb.."'")end)end
e(db,eb,hb)end
function
gAC.DRMAddClient(db,eb)local
fb=gAC[a.p][eb]if!fb
then
return
end
if
not
O
then
R(M)O=!!1
end
local
gb=!1
local
function
hb(ib)if
gb
and
not
ib
then
return
end
gb=!!1
N(db,eb)X[eb]=1
l(L,{license=gAC[a.r][a.q],file_ID=fb,addon="GlorifiedAnticheat"},function(jb)if
q(jb,1,4)=='ERR:'then
s("[GlorifiedDRM] File request failure for '"..fb.."'")s("[GlorifiedDRM] To prevent the system from recursive errors, the DRM has halted.")s("[GlorifiedDRM] ERR: "..jb)X[eb]=4
else
if
cb[fb]then
s("[GlorifiedDRM] File '"..fb.."' received after "..cb[fb].."/4 attempts")end
Z[#Z+1]={jb,eb}X[eb]=2
end
bb()end,function(jb)if
not
cb[fb]then
cb[fb]=1
else
cb[fb]=cb[fb]+1
end
if
cb[fb]and
cb[fb]>=4
then
s("[GlorifiedDRM] File request failure for '"..fb.."' all attempts failed.")s("[GlorifiedDRM] To prevent the system from recursive errors, the DRM has halted.")X[eb]=4
bb()else
s("[GlorifiedDRM] File request failure for '"..fb.."' retrying in 3s "..cb[fb].."/4")F(3,function()hb(!!1)end)end
s("[GlorifiedDRM] ERR: '"..jb.."'")end)end
e(db,eb,hb)end
concommand[a.s]('drm_filestatus',function()gAC[a.t]('GlorifiedDRM file status')for
db,eb
in
g(X)do
local
fb=""if
eb==0
then
fb="Not Requested"end
if
eb==1
then
fb="Not Received"end
if
eb==2
then
fb="Finializing"end
if
eb==3
then
fb="Executed"end
if
eb==4
then
fb="Request Error"end
if
eb==5
then
fb="Execution Error"end
s('[GlorifiedDRM] index "'..db.."' - "..fb)end
end)end
e("gAC.ClientLoaded","SendFiles",function(L)if#gAC[a.b]>0
then
for
M,N
in
b(gAC[a.b])do
if
gAC[a.b][M]==nil
then
continue
end
gAC[a.e]:Send("LoadPayload",gAC[a.b][M],L,!!1)end
E("gAC.CLFilesLoaded",L)end
end)local
K=!1
e('PlayerInitialSpawn','DidGacLoad?',function(L)if
gAC[a.e]and
gAC[a.e].ReceiveCount
then
return
end
if
K
then
return
end
gAC[a.t]('WARNING, gAC networking did not initialize in time.')gAC[a.t]('Chances are that something is wrong with your license key.')gAC[a.t]('Please contact the developers of gAC to resolve this.')K=!!1
end)